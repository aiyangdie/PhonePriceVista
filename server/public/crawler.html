<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‰‹æœºæ•°æ®çˆ¬å–ç®¡ç†</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .header h1 {
      font-size: 24px;
      color: #1e293b;
      margin-bottom: 8px;
    }
    .header p {
      color: #64748b;
      font-size: 14px;
    }
    .card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .card h2 {
      font-size: 18px;
      color: #1e293b;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .form-group {
      margin-bottom: 16px;
    }
    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #374151;
      margin-bottom: 6px;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s;
    }
    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    .btn-secondary {
      background: #f1f5f9;
      color: #475569;
    }
    .btn-secondary:hover {
      background: #e2e8f0;
    }
    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .results {
      margin-top: 20px;
    }
    .result-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #f8fafc;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    .result-item img {
      width: 60px;
      height: 60px;
      object-fit: contain;
      background: white;
      border-radius: 4px;
    }
    .result-item .info {
      flex: 1;
    }
    .result-item .name {
      font-weight: 600;
      color: #1e293b;
    }
    .result-item .link {
      font-size: 12px;
      color: #64748b;
      word-break: break-all;
    }
    .status {
      padding: 12px 16px;
      border-radius: 8px;
      margin-top: 16px;
      font-size: 14px;
    }
    .status.success {
      background: #ecfdf5;
      color: #065f46;
      border: 1px solid #a7f3d0;
    }
    .status.error {
      background: #fef2f2;
      color: #991b1b;
      border: 1px solid #fecaca;
    }
    .status.info {
      background: #eff6ff;
      color: #1e40af;
      border: 1px solid #bfdbfe;
    }
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #e5e7eb;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }
    .phone-card {
      background: #f8fafc;
      border-radius: 12px;
      padding: 16px;
      transition: transform 0.2s;
    }
    .phone-card:hover {
      transform: translateY(-2px);
    }
    .phone-card img {
      width: 100%;
      height: 150px;
      object-fit: contain;
      background: white;
      border-radius: 8px;
      margin-bottom: 12px;
    }
    .phone-card .name {
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 8px;
    }
    .phone-card .specs {
      font-size: 12px;
      color: #64748b;
    }
    .phone-card .specs div {
      margin-bottom: 4px;
    }
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
    }
    .tab {
      padding: 8px 16px;
      background: rgba(255,255,255,0.2);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }
    .tab.active {
      background: white;
      color: #667eea;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“± æ‰‹æœºæ•°æ®çˆ¬å–ç®¡ç†</h1>
      <p>ä» GSMArena çˆ¬å–æœ€æ–°æ‰‹æœºæ•°æ®ï¼ŒåŒ…æ‹¬å›¾ç‰‡ã€å‚æ•°å’Œè§„æ ¼</p>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="showTab('sync')">ğŸ”„ ä¸€é”®åŒæ­¥</button>
      <button class="tab" onclick="showTab('search')">ğŸ” æœç´¢æ‰‹æœº</button>
      <button class="tab" onclick="showTab('brand')">ğŸ“¦ æŒ‰å“ç‰Œçˆ¬å–</button>
      <button class="tab" onclick="showTab('import')">â¬‡ï¸ çˆ¬å–å¹¶å¯¼å…¥</button>
    </div>

    <!-- ä¸€é”®åŒæ­¥ -->
    <div id="tab-sync" class="card">
      <h2>ğŸ”„ æ•°æ®åŒæ­¥ç®¡ç†</h2>
      
      <!-- è‡ªåŠ¨åŒæ­¥çŠ¶æ€ -->
      <div style="background:#f0fdf4;border:1px solid #86efac;border-radius:8px;padding:16px;margin-bottom:16px;">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
          <span style="font-size:20px;">â°</span>
          <strong>è‡ªåŠ¨åŒæ­¥å·²å¯ç”¨</strong>
        </div>
        <p style="color:#166534;font-size:13px;margin:0;">
          ç³»ç»Ÿå°†åœ¨æ¯å¤© <strong>å‡Œæ™¨ 0:00</strong> è‡ªåŠ¨åŒæ­¥æ‰€æœ‰æ‰‹æœºçš„å›¾ç‰‡ã€å‚æ•°å’Œå®˜æ–¹ä»·æ ¼
        </p>
        <div id="nextSyncTime" style="color:#15803d;font-size:12px;margin-top:8px;"></div>
      </div>

      <p style="color: #64748b; font-size: 14px; margin-bottom: 16px;">
        å°†æ•°æ®åº“ä¸­ç°æœ‰æ‰‹æœºä¸é¢„ç½®çš„å®˜æ–¹æ•°æ®è¿›è¡ŒåŒ¹é…ï¼Œè‡ªåŠ¨å¡«å……å›¾ç‰‡ã€CPUã€ç”µæ± ã€å±å¹•ç­‰å‚æ•°ã€‚
      </p>
      <div class="btn-group" style="flex-wrap:wrap;">
        <button class="btn btn-primary" id="syncAllBtn" onclick="syncAllPhones()">
          ğŸ”„ ç«‹å³åŒæ­¥æ‰€æœ‰æ‰‹æœº
        </button>
        <button class="btn btn-secondary" onclick="viewPresetDatabase()">
          ğŸ“‹ æŸ¥çœ‹é¢„ç½®æ•°æ®
        </button>
        <button class="btn btn-secondary" onclick="viewSyncHistory()">
          ğŸ“Š åŒæ­¥å†å²
        </button>
      </div>
      <div id="syncStatus"></div>
      <div id="syncResults" class="results"></div>

      <!-- æ•°æ®å¯¼å‡º -->
      <div style="margin-top:24px;padding-top:20px;border-top:1px solid #e5e7eb;">
        <h3 style="font-size:16px;margin-bottom:12px;">ğŸ“¥ æ•°æ®å¯¼å‡º</h3>
        <div class="btn-group">
          <a href="/api/crawler/export/json" class="btn btn-secondary" download>
            ğŸ“„ å¯¼å‡º JSON
          </a>
          <a href="/api/crawler/export/csv" class="btn btn-secondary" download>
            ğŸ“Š å¯¼å‡º CSV (Excel)
          </a>
        </div>
      </div>
    </div>

    <!-- æœç´¢æ‰‹æœº -->
    <div id="tab-search" class="card" style="display:none;">
      <h2>ğŸ” æœç´¢æ‰‹æœº</h2>
      <div class="form-group">
        <label>æœç´¢å…³é”®è¯</label>
        <input type="text" id="searchQuery" placeholder="è¾“å…¥æ‰‹æœºå‹å·ï¼Œå¦‚ iPhone 16ã€Xiaomi 15...">
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="searchPhones()">æœç´¢</button>
      </div>
      <div id="searchResults" class="results"></div>
    </div>

    <!-- æŒ‰å“ç‰Œçˆ¬å– -->
    <div id="tab-brand" class="card" style="display:none;">
      <h2>ğŸ“¦ æŒ‰å“ç‰Œè·å–æ‰‹æœºåˆ—è¡¨</h2>
      <div class="form-group">
        <label>é€‰æ‹©å“ç‰Œ</label>
        <select id="brandSelect">
          <option value="OPPO">OPPO</option>
          <option value="vivo">vivo</option>
          <option value="å°ç±³">å°ç±³</option>
          <option value="åä¸º">åä¸º</option>
          <option value="è£è€€">è£è€€</option>
          <option value="iPhone">iPhone / Apple</option>
          <option value="ä¸€åŠ ">ä¸€åŠ </option>
          <option value="realme">realme</option>
          <option value="iQOO">iQOO</option>
          <option value="ä¸‰æ˜Ÿ">ä¸‰æ˜Ÿ</option>
        </select>
      </div>
      <div class="form-group">
        <label>è·å–æ•°é‡</label>
        <input type="number" id="brandLimit" value="10" min="1" max="50">
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="fetchBrandPhones()">è·å–åˆ—è¡¨</button>
      </div>
      <div id="brandResults" class="results"></div>
    </div>

    <!-- çˆ¬å–å¹¶å¯¼å…¥ -->
    <div id="tab-import" class="card" style="display:none;">
      <h2>â¬‡ï¸ çˆ¬å–å¹¶å¯¼å…¥åˆ°æ•°æ®åº“</h2>
      <p style="color: #64748b; font-size: 14px; margin-bottom: 16px;">
        æ­¤åŠŸèƒ½ä¼šä» GSMArena çˆ¬å–æ‰‹æœºæ•°æ®å¹¶è‡ªåŠ¨å¯¼å…¥åˆ°æ•°æ®åº“ä¸­ï¼ŒåŒ…æ‹¬å›¾ç‰‡å’Œè¯¦ç»†å‚æ•°ã€‚
      </p>
      <div class="form-group">
        <label>é€‰æ‹©å“ç‰Œï¼ˆç•™ç©ºè·å–æœ€æ–°æ‰‹æœºï¼‰</label>
        <select id="importBrand">
          <option value="">-- è·å–æœ€æ–°æ‰‹æœº --</option>
          <option value="OPPO">OPPO</option>
          <option value="vivo">vivo</option>
          <option value="å°ç±³">å°ç±³</option>
          <option value="åä¸º">åä¸º</option>
          <option value="è£è€€">è£è€€</option>
          <option value="iPhone">iPhone / Apple</option>
          <option value="ä¸€åŠ ">ä¸€åŠ </option>
          <option value="realme">realme</option>
          <option value="iQOO">iQOO</option>
          <option value="ä¸‰æ˜Ÿ">ä¸‰æ˜Ÿ</option>
        </select>
      </div>
      <div class="form-group">
        <label>å¯¼å…¥æ•°é‡</label>
        <input type="number" id="importLimit" value="5" min="1" max="20">
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" id="importBtn" onclick="crawlAndImport()">
          å¼€å§‹çˆ¬å–å¹¶å¯¼å…¥
        </button>
      </div>
      <div id="importStatus"></div>
    </div>

    <!-- è·å–è¯¦æƒ… -->
    <div class="card">
      <h2>ğŸ“‹ è·å–æ‰‹æœºè¯¦ç»†å‚æ•°</h2>
      <div class="form-group">
        <label>æ‰‹æœºé“¾æ¥ï¼ˆGSMArena URLï¼‰</label>
        <input type="text" id="detailUrl" placeholder="https://www.gsmarena.com/xxxxx.php">
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="fetchDetails()">è·å–è¯¦æƒ…</button>
      </div>
      <div id="detailResults" class="results"></div>
    </div>
  </div>

  <script>
    const API_BASE = '/api/crawler';

    function showTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('[id^="tab-"]').forEach(t => t.style.display = 'none');
      event.target.classList.add('active');
      document.getElementById('tab-' + tab).style.display = 'block';
    }

    async function searchPhones() {
      const query = document.getElementById('searchQuery').value.trim();
      if (!query) return alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
      
      const resultsDiv = document.getElementById('searchResults');
      resultsDiv.innerHTML = '<div class="status info"><span class="loading"></span> æœç´¢ä¸­...</div>';
      
      try {
        const res = await fetch(`${API_BASE}/search?q=${encodeURIComponent(query)}`);
        const data = await res.json();
        
        if (data.success && data.data.length > 0) {
          resultsDiv.innerHTML = `<div class="status success">æ‰¾åˆ° ${data.data.length} ä¸ªç»“æœ</div>` +
            data.data.map(p => `
              <div class="result-item">
                <img src="${p.thumbnail || ''}" onerror="this.style.display='none'">
                <div class="info">
                  <div class="name">${p.name}</div>
                  <div class="link">${p.link}</div>
                </div>
                <button class="btn btn-secondary" onclick="document.getElementById('detailUrl').value='${p.link}'">
                  è·å–è¯¦æƒ…
                </button>
              </div>
            `).join('');
        } else {
          resultsDiv.innerHTML = '<div class="status error">æœªæ‰¾åˆ°ç»“æœ</div>';
        }
      } catch (e) {
        resultsDiv.innerHTML = `<div class="status error">æœç´¢å¤±è´¥: ${e.message}</div>`;
      }
    }

    async function fetchBrandPhones() {
      const brand = document.getElementById('brandSelect').value;
      const limit = document.getElementById('brandLimit').value;
      
      const resultsDiv = document.getElementById('brandResults');
      resultsDiv.innerHTML = '<div class="status info"><span class="loading"></span> è·å–ä¸­...</div>';
      
      try {
        const res = await fetch(`${API_BASE}/brand/${encodeURIComponent(brand)}?limit=${limit}`);
        const data = await res.json();
        
        if (data.success && data.data.length > 0) {
          resultsDiv.innerHTML = `<div class="status success">è·å–åˆ° ${data.data.length} æ¬¾ ${brand} æ‰‹æœº</div>` +
            data.data.map(p => `
              <div class="result-item">
                <img src="${p.thumbnail || ''}" onerror="this.style.display='none'">
                <div class="info">
                  <div class="name">${p.name}</div>
                  <div class="link">${p.link}</div>
                </div>
                <button class="btn btn-secondary" onclick="document.getElementById('detailUrl').value='${p.link}'">
                  è·å–è¯¦æƒ…
                </button>
              </div>
            `).join('');
        } else {
          resultsDiv.innerHTML = `<div class="status error">è·å–å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
        }
      } catch (e) {
        resultsDiv.innerHTML = `<div class="status error">è·å–å¤±è´¥: ${e.message}</div>`;
      }
    }

    async function fetchDetails() {
      const url = document.getElementById('detailUrl').value.trim();
      if (!url) return alert('è¯·è¾“å…¥æ‰‹æœºé“¾æ¥');
      
      const resultsDiv = document.getElementById('detailResults');
      resultsDiv.innerHTML = '<div class="status info"><span class="loading"></span> è·å–è¯¦æƒ…ä¸­...</div>';
      
      try {
        const res = await fetch(`${API_BASE}/details?url=${encodeURIComponent(url)}`);
        const data = await res.json();
        
        if (data.success && data.data) {
          const phone = data.data;
          resultsDiv.innerHTML = `
            <div class="grid" style="margin-top: 16px;">
              <div class="phone-card">
                <img src="${phone.image || ''}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>ğŸ“±</text></svg>'">
                <div class="name">${phone.name}</div>
                <div class="specs">
                  ${phone.specs.cpu ? `<div>ğŸ’» ${phone.specs.cpu}</div>` : ''}
                  ${phone.specs.screenSize ? `<div>ğŸ“± ${phone.specs.screenSize}</div>` : ''}
                  ${phone.specs.battery ? `<div>ğŸ”‹ ${phone.specs.battery}</div>` : ''}
                  ${phone.specs.mainCamera ? `<div>ğŸ“· ${phone.specs.mainCamera}</div>` : ''}
                  ${phone.specs.os ? `<div>âš™ï¸ ${phone.specs.os}</div>` : ''}
                  ${phone.specs.memory ? `<div>ğŸ’¾ ${phone.specs.memory}</div>` : ''}
                  ${phone.specs.dimensions ? `<div>ğŸ“ ${phone.specs.dimensions}</div>` : ''}
                  ${phone.specs.weight ? `<div>âš–ï¸ ${phone.specs.weight}</div>` : ''}
                </div>
              </div>
            </div>
            <details style="margin-top: 16px;">
              <summary style="cursor: pointer; color: #667eea;">æŸ¥çœ‹åŸå§‹æ•°æ®</summary>
              <pre style="background: #f8fafc; padding: 12px; border-radius: 8px; overflow: auto; font-size: 12px;">${JSON.stringify(phone, null, 2)}</pre>
            </details>
          `;
        } else {
          resultsDiv.innerHTML = `<div class="status error">è·å–å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
        }
      } catch (e) {
        resultsDiv.innerHTML = `<div class="status error">è·å–å¤±è´¥: ${e.message}</div>`;
      }
    }

    async function crawlAndImport() {
      const brand = document.getElementById('importBrand').value;
      const limit = document.getElementById('importLimit').value;
      const btn = document.getElementById('importBtn');
      const statusDiv = document.getElementById('importStatus');
      
      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span> çˆ¬å–ä¸­...';
      statusDiv.innerHTML = '<div class="status info"><span class="loading"></span> æ­£åœ¨çˆ¬å–æ•°æ®ï¼Œè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´...</div>';
      
      try {
        const res = await fetch(`${API_BASE}/crawl-and-import`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ brand: brand || undefined, limit: parseInt(limit) })
        });
        const data = await res.json();
        
        if (data.success) {
          statusDiv.innerHTML = `
            <div class="status success">
              âœ… çˆ¬å–å®Œæˆï¼<br>
              æ€»è®¡: ${data.total} æ¬¾<br>
              æ–°å¢: ${data.imported} æ¬¾<br>
              æ›´æ–°: ${data.updated} æ¬¾
            </div>
          `;
        } else {
          statusDiv.innerHTML = `<div class="status error">çˆ¬å–å¤±è´¥: ${data.error || data.message}</div>`;
        }
      } catch (e) {
        statusDiv.innerHTML = `<div class="status error">çˆ¬å–å¤±è´¥: ${e.message}</div>`;
      } finally {
        btn.disabled = false;
        btn.innerHTML = 'å¼€å§‹çˆ¬å–å¹¶å¯¼å…¥';
      }
    }

    // å›è½¦æœç´¢
    document.getElementById('searchQuery').addEventListener('keypress', e => {
      if (e.key === 'Enter') searchPhones();
    });

    // ==================== ä¸€é”®åŒæ­¥åŠŸèƒ½ ====================
    
    async function syncAllPhones() {
      const btn = document.getElementById('syncAllBtn');
      const statusDiv = document.getElementById('syncStatus');
      const resultsDiv = document.getElementById('syncResults');
      
      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span> åŒæ­¥ä¸­...';
      statusDiv.innerHTML = '<div class="status info"><span class="loading"></span> æ­£åœ¨åŒæ­¥æ•°æ®åº“ä¸­çš„æ‰‹æœºæ•°æ®...</div>';
      resultsDiv.innerHTML = '';
      
      try {
        const res = await fetch(`${API_BASE}/sync-all`, { method: 'POST' });
        const data = await res.json();
        
        if (data.success) {
          statusDiv.innerHTML = `
            <div class="status success">
              âœ… åŒæ­¥å®Œæˆï¼<br>
              æ€»è®¡: ${data.total} æ¬¾æ‰‹æœº<br>
              æˆåŠŸåŒæ­¥: ${data.synced} æ¬¾<br>
              æœªåŒ¹é…: ${data.failed} æ¬¾
            </div>
          `;
          
          // æ˜¾ç¤ºè¯¦ç»†ç»“æœ
          if (data.details && data.details.length > 0) {
            resultsDiv.innerHTML = data.details.map(d => `
              <div class="result-item" style="background: ${d.success ? '#ecfdf5' : '#fef2f2'}">
                <div class="info">
                  <div class="name">${d.brand} ${d.model}</div>
                  <div class="link" style="color: ${d.success ? '#065f46' : '#991b1b'}">
                    ${d.success ? 'âœ… å·²åŒ¹é…: ' + d.matched : 'âŒ ' + d.error}
                  </div>
                </div>
              </div>
            `).join('');
          }
        } else {
          statusDiv.innerHTML = `<div class="status error">åŒæ­¥å¤±è´¥: ${data.error || data.message}</div>`;
        }
      } catch (e) {
        statusDiv.innerHTML = `<div class="status error">åŒæ­¥å¤±è´¥: ${e.message}</div>`;
      } finally {
        btn.disabled = false;
        btn.innerHTML = 'ğŸ”„ ä¸€é”®åŒæ­¥æ‰€æœ‰æ‰‹æœº';
      }
    }
    
    async function viewPresetDatabase() {
      const resultsDiv = document.getElementById('syncResults');
      resultsDiv.innerHTML = '<div class="status info"><span class="loading"></span> åŠ è½½é¢„ç½®æ•°æ®...</div>';
      
      try {
        const res = await fetch(`${API_BASE}/preset-database`);
        const data = await res.json();
        
        if (data.success && data.data.length > 0) {
          resultsDiv.innerHTML = `<div class="status success">é¢„ç½®æ•°æ®åº“å…±æœ‰ ${data.count} æ¬¾æ‰‹æœº</div>
            <div class="grid" style="margin-top: 16px;">
              ${data.data.map(p => `
                <div class="phone-card">
                  <img src="${p.image || ''}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>ğŸ“±</text></svg>'">
                  <div class="name">${p.brand} ${p.model}</div>
                  <div class="specs">
                    <div>ğŸ’° å®˜æ–¹ä»·: Â¥${p.official_price || 'æœªçŸ¥'}</div>
                    <div>ğŸ’» ${p.cpu || 'æœªçŸ¥'}</div>
                    <div>ğŸ”‹ ${p.battery || 'æœªçŸ¥'}</div>
                    <div>ğŸ“± ${p.screen_size || 'æœªçŸ¥'}</div>
                  </div>
                </div>
              `).join('')}
            </div>`;
        } else {
          resultsDiv.innerHTML = '<div class="status error">æ— é¢„ç½®æ•°æ®</div>';
        }
      } catch (e) {
        resultsDiv.innerHTML = `<div class="status error">åŠ è½½å¤±è´¥: ${e.message}</div>`;
      }
    }

    // æŸ¥çœ‹åŒæ­¥å†å²
    async function viewSyncHistory() {
      const resultsDiv = document.getElementById('syncResults');
      resultsDiv.innerHTML = '<div class="status info"><span class="loading"></span> åŠ è½½åŒæ­¥å†å²...</div>';
      
      try {
        const res = await fetch(`${API_BASE}/sync-status`);
        const data = await res.json();
        
        if (data.success) {
          let html = `
            <div class="status success">
              åŒæ­¥æœåŠ¡: ${data.isRunning ? 'âœ… è¿è¡Œä¸­' : 'âŒ å·²åœæ­¢'}<br>
              ä¸‹æ¬¡åŒæ­¥: ${new Date(data.nextSyncTime).toLocaleString()}
            </div>
          `;
          
          if (data.recentLogs && data.recentLogs.length > 0) {
            html += `
              <h4 style="margin:16px 0 8px;">æœ€è¿‘åŒæ­¥è®°å½•</h4>
              <table style="width:100%;font-size:13px;border-collapse:collapse;">
                <tr style="background:#f8fafc;">
                  <th style="padding:8px;text-align:left;">æ—¶é—´</th>
                  <th style="padding:8px;text-align:left;">ç±»å‹</th>
                  <th style="padding:8px;text-align:left;">æ€»æ•°</th>
                  <th style="padding:8px;text-align:left;">æˆåŠŸ</th>
                  <th style="padding:8px;text-align:left;">å¤±è´¥</th>
                  <th style="padding:8px;text-align:left;">çŠ¶æ€</th>
                </tr>
                ${data.recentLogs.map(log => `
                  <tr style="border-bottom:1px solid #f1f5f9;">
                    <td style="padding:8px;">${new Date(log.synced_at).toLocaleString()}</td>
                    <td style="padding:8px;">${log.sync_type === 'auto' ? 'ğŸ¤– è‡ªåŠ¨' : 'ğŸ‘† æ‰‹åŠ¨'}</td>
                    <td style="padding:8px;">${log.total_records}</td>
                    <td style="padding:8px;color:#10b981;">${log.success_records}</td>
                    <td style="padding:8px;color:#ef4444;">${log.failed_records}</td>
                    <td style="padding:8px;">
                      <span style="padding:2px 6px;border-radius:4px;font-size:11px;background:${log.status === 'completed' ? '#ecfdf5' : '#fef2f2'};color:${log.status === 'completed' ? '#065f46' : '#991b1b'};">
                        ${log.status === 'completed' ? 'âœ… å®Œæˆ' : 'âŒ å¤±è´¥'}
                      </span>
                    </td>
                  </tr>
                `).join('')}
              </table>
            `;
          }
          
          resultsDiv.innerHTML = html;
        } else {
          resultsDiv.innerHTML = `<div class="status error">åŠ è½½å¤±è´¥: ${data.error}</div>`;
        }
      } catch (e) {
        resultsDiv.innerHTML = `<div class="status error">åŠ è½½å¤±è´¥: ${e.message}</div>`;
      }
    }

    // åŠ è½½ä¸‹æ¬¡åŒæ­¥æ—¶é—´
    async function loadNextSyncTime() {
      try {
        const res = await fetch(`${API_BASE}/sync-status`);
        const data = await res.json();
        if (data.success && data.nextSyncTime) {
          const nextSync = new Date(data.nextSyncTime);
          const now = new Date();
          const diff = nextSync - now;
          const hours = Math.floor(diff / 1000 / 60 / 60);
          const minutes = Math.floor((diff / 1000 / 60) % 60);
          document.getElementById('nextSyncTime').textContent = 
            `ä¸‹æ¬¡è‡ªåŠ¨åŒæ­¥: ${nextSync.toLocaleString()} (${hours}å°æ—¶${minutes}åˆ†é’Ÿå)`;
        }
      } catch (e) {
        console.error('è·å–åŒæ­¥çŠ¶æ€å¤±è´¥:', e);
      }
    }

    // é¡µé¢åŠ è½½æ—¶è·å–åŒæ­¥çŠ¶æ€
    loadNextSyncTime();
  </script>
</body>
</html>
